<?php

namespace {{invokerPackage}}\Test\Sdk\OAuth2;

use {{invokerPackage}}\Test\Sdk\Enums\GrantType;
use {{invokerPackage}}\Test\Sdk\KindeClientSDK;
use {{invokerPackage}}\Test\Sdk\Utils\Utils;
use {{invokerPackage}}\Test\Sdk\Storage\Storage;

class AuthorizationCode
{
    /**
     * @var Storage
     */
    protected $storage;

    function __construct()
    {
        $this->storage = Storage::getInstance();
    }

    public function authenticate(KindeClientSDK $clientSDK, array $additionalParameters = [])
    {
        $state = Utils::randomString();
        $this->storage->setState($state);
        $searchParams = [
            'client_id' => $clientSDK->clientId,
            'grant_type' => GrantType::authorizationCode,
            'redirect_uri' => $clientSDK->redirectUri,
            'response_type' => 'code',
            'scope' => $clientSDK->scopes,
            'state' => $state,
            'start_page' => 'login'
        ];
        $mergedAdditionalParameters = Utils::addAdditionalParameters($clientSDK->additionalParameters, $additionalParameters);
        $searchParams = array_merge($searchParams, $mergedAdditionalParameters);

        return 'redirecting...';
    }
}
